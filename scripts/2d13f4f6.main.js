function init(){$(".loader").delay(1e3).animate({opacity:"0"},1e3,"easeOutCubic",function(){$(".loader-label").html('<img src="images/ajax-loader.gif">Fetching Info...'),$(".loader").css({opacity:1,left:"-100%"}),$(".elements-hidden").each(function(a){var b=$("."+elements[a]);setTimeout(function(){b.removeClass("elements-hidden"),b.addClass("elements-show")},120*(a+1))}),setTimeout(function(){$("input.username-input").focus()},1e3)})}function getScrobble(a){a.preventDefault(),console.log("lets get it started!");var b=$(".username-input").val(),c=currUrl+"myscrobble.html?username="+b;$(".loader").animate({left:"0"},800,"easeOutCubic",function(){window.location.href=c})}function getTracks(){$.ajax({url:"https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user="+username+"&api_key="+apikey+"&format=json&limit=10",crossDomain:!0,dataType:"json",success:function(a){var b=a.recenttracks.track;b||$(".loader-label").html("You haven't scrobbled anything yet. Get into it!");var c=b[0];if(artistName=c.artist["#text"],artwork=c.image[3]["#text"],artist=c.artist["#text"],song=c.name,songURL=c.url,album=c.album["#text"],artworkHTML="<img src='"+artwork+"' alt='"+album+"'>",artistHTML="<h1><a href='"+songURL+"'>"+artist+"</h1>",songHTML="<h2>"+song+"</a></h2>",nowPlaying=c["@attr"],void 0==nowPlaying){date=c.date["#text"],dateHTML="<span class='date'>"+date+"</span>";var d=document.createElement("link");d.rel="shortcut icon",d.href="favicon.ico?v=2.2",document.getElementsByTagName("head")[0].appendChild(d)}else{console.log("nowplaying"),dateHTML="<img src='images/eq.gif' style='display:block; width: 75px; margin: 0 auto'><span class='listening'>Now Listening!</span>";var d=document.createElement("link");d.rel="shortcut icon",d.href="favicon-playing.ico?v=1",d.type="image/x-icon",document.getElementsByTagName("head")[0].appendChild(d)}$(".last-scrobble-wrap").append("<div class='last-scrobble'>"+artworkHTML+artistHTML+songHTML+dateHTML+"</div>");for(var e=1;e<b.length;++e){var f=b[e];artwork=f.image[2]["#text"],artist=f.artist["#text"],song=f.name,songURL=f.url,album=f.album["#text"],date=f.date["#text"],artworkHTML="<img src='"+artwork+"' alt='"+album+"'>",artistHTML="<div class='track-info'><h1><a href='"+songURL+"'>"+artist+" - "+song+"</a></h1>",dateHTML="<p>"+date+"</p></div>",$(".recent-tracks .scrobbles-list").append("<div class='scrobble'>"+artworkHTML+artistHTML+dateHTML+"</div>")}searchImage(artistName),fetchUserInfo()},error:function(){alert("Error loading data. Reload the page.")}})}function fetchUserInfo(){$.ajax({url:"https://ws.audioscrobbler.com/2.0/?method=user.getinfo&user="+username+"&api_key="+apikey+"&format=json",crossDomain:!0,dataType:"json",success:function(a){var b=a.user.realname,c=a.user.name,d=a.user.image[3]["#text"],e=a.user.playcount;$(".more-button").append("Check out "+b+"'s recent tracks"),$(".navbar-brand").append('<a title="View user\'s info" class="username">/'+c+"</a>"),$(".user-info .username").append(b),$(".user-info .avatar").css("background","url("+d+") no-repeat center center"),$(".user-info .playcount").append('<span class="glyphicon glyphicon-music" aria-hidden="true"></span> '+e+" Plays<br>")},error:function(){$(".loader-label").append(" Error loading data. Reload the page.")}}),$.ajax({url:"https://ws.audioscrobbler.com/2.0/?method=user.gettoptags&user="+username+"&api_key="+apikey+"&format=json",crossDomain:!0,dataType:"json",success:function(a){var b,c=a.toptags.tag;if(b=c.length<10?c.length:10,c)for(var d=0;b>d;d++){var e=c[d],f=e.name,g=e.url;$(".user-info .tags").append('<span><a href="https://'+g+'" target="_blank">'+f+"</a></span>")}},error:function(){$(".loader-label").append(" Error loading data. Reload the page.")}}),$.ajax({url:"https://ws.audioscrobbler.com/2.0/?method=user.getlovedtracks&user="+username+"&api_key="+apikey+"&format=json",crossDomain:!0,dataType:"json",success:function(a){var b=a.lovedtracks.track,c=a.lovedtracks["@attr"].total;if($(".user-info .playcount").append('<span class="glyphicon glyphicon-heart" aria-hidden="true"></span> '+c+" Loved Tracks<br>"),b)for(var d=0;5>d;d++){var e=b[d],f=e.name,g=e.artist.name;$(".user-info .loved").append('<div class="track"><span class="name">'+f+'</span><span class="artist">'+g+"</span></div>")}},error:function(){$(".loader-label").append(" Error loading data. Reload the page.")}}),fetchLovedTracks()}function fetchLovedTracks(){$.ajax({url:"https://ws.audioscrobbler.com/2.0/?method=user.getlovedtracks&user="+username+"&api_key="+apikey+"&format=json&limit=9",crossDomain:!0,dataType:"json",success:function(a){console.log("Loved tracks",a);var b=a.lovedtracks.track;if(b){for(var c=0;c<b.length;c++){var d=b[c],e=d.name,f=d.url,g=d.artist.name,h=d.image[3]["#text"];artworkHTML="<a href='"+f+"' target='_blank'><img src='"+h+"' alt='"+e+"'>",artistHTML="<div class='release-info'><h1>"+e+"</h1><h2>"+g+"</h2></a>",$(".new-releases .releases-list").append("<div class='release'>"+artworkHTML+artistHTML+"</div>")}fetchArtistInfo()}else $(".new-releases").css("display","none"),fetchArtistInfo()},error:function(){$(".loader-label").append(" Error loading data. Reload the page.")}})}function fetchArtistInfo(){$.ajax({url:"https://ws.audioscrobbler.com/2.0/?method=artist.getinfo&artist="+artistName+"&api_key="+apikey+"&format=json",crossDomain:!0,dataType:"json",success:function(a){console.log("On Tour",a);var b=a.artist.ontour;1==b&&$(".last-scrobble h2").after('<span class="ontour"><span class="glyphicon glyphicon-fire" aria-hidden="true"></span> On tour!</span>'),$(".loader-label").append(" done!"),$(".loader").delay(1e3).animate({left:"100%"},800,"easeOutCubic",function(){$(".loader").fadeOut()})},error:function(){$(".loader-label").append(" Error loading data. Reload the page.")}})}function searchImage(a){console.log("fetching image for: "+a);var b="https://www.googleapis.com";$.ajax({url:b+"/customsearch/v1?q=group+"+a.replace(/\s/g,"+")+"&searchType=image&cx="+CSEID+"&key="+APIKEY,crossDomain:!0,dataType:"jsonp",success:function(a){function b(a,b){var d=Math.floor(Math.random()*(b-a+1)+a),e=c[d].link;$(".page-wrap").css("background","url("+e+") no-repeat 50% center")}var c=a.items;if(console.log("Image",c),c.length){var d=0,e=3;b(d,e)}},error:function(){alert("Error loading data. Reload the page.")}})}function GetUrlValue(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}}var CSEID="015322544866411100232:i941ndyid74",APIKEY="AIzaSyDcuiakLRK_ou8J42V1t-ABvnKWNsg_wRo",scrollPos,artistName,artworkHTML,artistHTML,songHTML,dateHTML,artwork,artist,song,songURL,album,date,nowPlaying,username=GetUrlValue("username"),apikey="02f64007fda57f97ec5088a624c873c2",currUrl=window.location.href,elements=["username-h1","username-p","username-form"];$(".more-button").on("click",function(){$.scrollTo(".recent-tracks",1e3,{easing:"easeOutCubic"})}),$("#username").on("submit",getScrobble),$(window).scroll(function(){scrollPos=$(window).scrollTop(),$(".page-wrap").css("background-position-y",Math.min(75,50+scrollPos/25)+"%"),$(".bg-artist-fade").css("opacity",Math.min(1,scrollPos/800)),$(".last-scrobble").css("-webkit-transform","translateY("+scrollPos*-.2+"px)"),scrollPos>30?$("#main-nav").css("-webkit-transform","translateY(-80px)"):$("#main-nav").css("-webkit-transform","translateY(0px)"),scrollPos>$("#recent-tracks").offset().top-$(window).height()/1.4&&$(".scrobble").each(function(a){setTimeout(function(){$(".scrobble").eq(a).addClass("is-showing-tracks")},150*(a+1))}),scrollPos>$("#new-releases").offset().top-$(window).height()/1.4&&$(".release").each(function(a){setTimeout(function(){$(".release").eq(a).addClass("is-showing-releases")},150*(a+1))})}),$(".fb-icon").on("click",function(){var a="MyScrobble.fm";window.open("http://www.facebook.com/sharer.php?u="+encodeURIComponent(currUrl)+"&t="+encodeURIComponent(a),"sharer","toolbar=0,status=0,width=626,height=352")}),$(".gp-icon").on("click",function(){window.open("https://plus.google.com/share?url="+encodeURIComponent(currUrl),"sharer","toolbar=0,status=0,width=626,height=352")}),$(".tw-icon").on("click",function(){window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(currUrl)+"&text=Check out MyScrobble.","sharer","toolbar=0,status=0,width=626,height=352")});